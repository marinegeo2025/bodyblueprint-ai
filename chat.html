<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AI Trainer | BodyBlueprint AI</title>

    <!-- Use your updated Modern Biohacker stylesheet here -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Optional inline chat page styling -->
    <style>
      /* Minimal styling for the chat page that complements 'styles.css' */

      .chat-container {
        max-width: 600px;
        margin: 20px auto;
        text-align: left;
        font-family: Arial, sans-serif;
      }

      .intro-section {
        margin-bottom: 30px;
      }

      .intro-section h1 {
        margin-bottom: 10px;
      }

      .intro-section p {
        margin-bottom: 10px;
        text-align: justify;
      }

      .input-area {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
      }

      .input-area textarea {
        width: 100%;
        min-height: 80px;
        font-family: inherit;
        padding: 10px;
        resize: vertical;
      }

      .response-area {
        position: relative;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        min-height: 80px;
        background-color: #f9f9f9;
      }

      .copy-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #eee;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 0.85em;
        cursor: pointer;
      }
      .copy-button:hover {
        background-color: #ddd;
      }
    </style>
  </head>

  <body>
    <!-- NAVIGATION -->
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="bmr.html">Blueprint</a></li>
        <li><a href="weight.html">Metrics</a></li>
        <li><a href="meals.html">Fuel</a></li>
        <li><a href="chat.html">AI Trainer</a></li>
      </ul>
    </nav>

    <!-- MAIN CHAT CONTAINER -->
    <main class="chat-container">
      <!-- Introduction -->
      <div class="intro-section">
        <h1>Meet Al, Your BodyBlueprint AI Trainer</h1>
        <p style="text-align: center; font-weight: bold;">
          A high-performance, evidence-based coach designed to accelerate your body transformation.
        </p>
        <p>
          Welcome! I’m <strong>Al</strong>, your personal fitness coach built on
          cutting-edge AI. My mission is to optimize your training, dial in your nutrition,
          and refine your supplementation based on real science—no myths or quick-fix gimmicks.
        </p>
        <p>
          Whether you want a new hypertrophy program, strategies for faster fat loss, or
          guidance on macros and meal timing, I’ve got you covered. I’ll translate the latest
          research into actionable steps aligned with your lifestyle and goals.
        </p>
        <p>
          Ask me anything: from crafting a personalized workout split to practical tips on
          boosting recovery. Once I respond, you can easily copy my answer using the button
          in the corner. Let’s unlock your full potential together!
        </p>
      </div>

      <!-- User input area -->
      <div class="input-area">
        <textarea
          id="userQuestion"
          placeholder="Ask me about workouts, macros, supplementation, etc."
        ></textarea>
        <button id="askButton" class="button5">Ask Al</button>
      </div>

      <!-- AI response area with copy button -->
      <div class="response-area" id="responseContainer">
        <button class="copy-button" id="copyButton">Copy</button>
        <div id="aiResponse">Awaiting your question...</div>
      </div>
    </main>

    <footer class="footer-note">
      <p>&copy; 2025 BodyBlueprint AI</p>
    </footer>

    <!-- CLIENT-SIDE SCRIPT -->
    <script>
      const askButton = document.getElementById('askButton');
      const userQuestion = document.getElementById('userQuestion');
      const aiResponse = document.getElementById('aiResponse');
      const copyButton = document.getElementById('copyButton');

      // Send user's question to /api/chat
      askButton.addEventListener('click', async () => {
        const question = userQuestion.value.trim();
        if (!question) return; // ignore empty input

        aiResponse.textContent = 'Processing your request...';

        try {
          // POST to /api/chat
          const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question }),
          });

          if (!response.ok) {
            aiResponse.textContent = 'Server error. Please try again.';
            return;
          }
          const data = await response.json();
          if (data.answer) {
            aiResponse.textContent = data.answer;
          } else {
            aiResponse.textContent = data.error || 'No answer received.';
          }
        } catch (err) {
          console.error('❌ Chat request failed:', err);
          aiResponse.textContent = 'Network or server error. Please try again.';
        }
      });

      // Copy the AI response text
      copyButton.addEventListener('click', () => {
        const range = document.createRange();
        range.selectNodeContents(aiResponse);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        try {
          document.execCommand('copy');
          alert('AI response copied to clipboard!');
        } catch (err) {
          console.error('Failed to copy text:', err);
        }
        selection.removeAllRanges();
      });
    </script>
  </body>
</html>
