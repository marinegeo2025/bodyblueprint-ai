<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AI Chat - 本来の面目 Honrai no Menmoku</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* Minimal styling for the chat page */

      .chat-container {
        max-width: 600px;
        margin: 20px auto;
        text-align: left;
        font-family: Arial, sans-serif;
      }

      .intro-section {
        margin-bottom: 30px;
      }

      .intro-section h1 {
        margin-bottom: 10px;
      }

      .intro-section p {
        margin-bottom: 10px;
        text-align: justify;
      }

      .input-area {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
      }

      .input-area textarea {
        width: 100%;
        min-height: 80px;
        font-family: inherit;
        padding: 10px;
        resize: vertical;
      }

      .input-area button {
        align-self: flex-end;
        padding: 8px 16px;
        cursor: pointer;
        background-color: #444;
        color: #fff;
        border: none;
        border-radius: 5px;
      }
      .input-area button:hover {
        background-color: #333;
      }

      .response-area {
        position: relative;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        min-height: 80px;
        background-color: #f9f9f9;
      }

      .copy-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #eee;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 0.85em;
        cursor: pointer;
      }
      .copy-button:hover {
        background-color: #ddd;
      }

      /* Basic nav styling */
      nav ul {
        list-style-type: none;
        padding: 10px;
        background: #333333;
        text-align: center;
      }
      nav ul li {
        display: inline-block;
        margin: 0 10px;
      }
      nav ul li a {
        color: white;
        text-decoration: none;
        font-size: 18px;
      }

      footer {
        text-align: center;
        margin-top: 40px;
        font-size: 0.9em;
        color: #555;
      }
    </style>
  </head>
  <body>
    <nav>
      <ul>
        <li><a href="index.html">家 Home</a></li>
        <li><a href="bmr.html">強 BMR</a></li>
        <li><a href="weight.html">落 Weight</a></li>
        <li><a href="meals.html">食 Meals</a></li>
        <li><a href="chat.html">話 AI Chat</a></li>
      </ul>
    </nav>

    <main class="chat-container">
      <!-- Introduction -->
      <div class="intro-section">
        <h1>Meet Al, Your Elite Fitness Trainer</h1>
        <p>
        <p style="text-align: center;">
  <strong>Hello, I’m Al, your personal, elite fitness trainer built on evidence-based, science-backed AI.</strong>
</p>
My goal is to help you achieve your aesthetic and performance targets by combining advanced training strategies,
          data-driven meal prep, and intelligent supplementation tips that actually work. Whether you’re looking for new
          ways to boost muscle definition, streamline your nutrition, or fine-tune recovery, I’m here to provide specific,
          science-based guidance—no fluff or quick fixes.
        </p>
        <p>
          From crafting a personalized weekly workout plan to outlining precise macros for different fitness phases, I’ll
          make sure each recommendation is both realistic and aligned with your goals. Feel free to ask about any aspect of
          training, dietary planning, or supplementation. I’ll translate the latest research into practical steps and strategies
          that fit your lifestyle, ensuring you stay motivated and consistently see progress.
        </p>
        <p>
          Go ahead—type your questions below. Once I respond, you can easily copy my answer using the small selection icon in
          the corner of the text box. Let’s start your journey together and maximize your results!
        </p>
      </div>

      <!-- User input area -->
      <div class="input-area">
        <textarea id="userQuestion" placeholder="Ask me about nutrition, training, supplementation..."></textarea>
        <button id="askButton">Ask Al</button>
      </div>

      <!-- AI response area with copy button -->
      <div class="response-area" id="responseContainer">
        <button class="copy-button" id="copyButton">Copy</button>
        <div id="aiResponse">Awaiting your question...</div>
      </div>
    </main>

    <footer>
      <p>本来の面目 Honrai no Menmoku &copy; 2025</p>
    </footer>

    <script>
      const askButton = document.getElementById("askButton");
      const userQuestion = document.getElementById("userQuestion");
      const aiResponse = document.getElementById("aiResponse");
      const copyButton = document.getElementById("copyButton");

      // On "Ask Alex," send the question to /api/chat
      askButton.addEventListener("click", async () => {
        const question = userQuestion.value.trim();
        if (!question) return; // ignore empty

        aiResponse.textContent = "Processing your request...";
        
        try {
          // Make a POST request to /api/chat
          const response = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
          });

          if (!response.ok) {
            aiResponse.textContent = "Server error. Please try again.";
            return;
          }
          const data = await response.json();
          if (data.answer) {
            aiResponse.textContent = data.answer;
          } else {
            aiResponse.textContent = data.error || "No answer received.";
          }

        } catch (err) {
          console.error("❌ Chat request failed:", err);
          aiResponse.textContent = "Network or server error. Please try again.";
        }
      });

      // Copy the AI response text
      copyButton.addEventListener("click", () => {
        const range = document.createRange();
        range.selectNodeContents(aiResponse);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);

        try {
          document.execCommand("copy");
          alert("AI's response copied to clipboard!");
        } catch (err) {
          console.error("Failed to copy text:", err);
        }
        selection.removeAllRanges();
      });
    </script>
  </body>
</html>
